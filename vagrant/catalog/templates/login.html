<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-signin-client_id" content="{{CLIENT_ID}}">
    <title>Login</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>
<div class="login">Please Login with Google Account </div>
<div class="g-signin2" data-onsuccess="onSignIn"></div>
<div id="result"></div>
<script>
    function onSignIn(googleUser) {
        // get basic profile information.
        var profile = googleUser.getBasicProfile();
        console.log('ID: ' + profile.getId());
        console.log('Name: ' + profile.getName());
        console.log('Image URL: ' + profile.getImageUrl());
        console.log('Email: ' + profile.getEmail());

        // get id_token from auth response.
        var id_token = googleUser.getAuthResponse().id_token;

        $.ajax({
            type: 'POST',
            url: '/oauth2callback?state={{STATE}}', // send the state token to the server for anti forgery
            processData: false,
            data: id_token, // send id_token to the server
            contentType: 'application/octet-stream; charset=utf-8',
            success: function (result) {
                // Handle or verify the server response if necessary.
                if (result) {
                    $('#result').html('Login Successful!</br>' + result + '</br>Redirecting...');
                    setTimeout(function () {
                        window.location.href = "/courses";
                    }, 4000);
                }
                else {
                    $('#result').html('Failed to make a server-side call. Check your configuration and console.');
                }
            }
        })
    }

</script>

</body>
</html>